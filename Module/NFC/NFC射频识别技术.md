# NFC射频识别技术

工作原理：

	读写器向M1卡发一组固定频率的电磁波，卡片内有一个LC串联谐振电路，其频率与读写器发射的频率相同，在电磁波的激励下，LC谐振电路产生共振，从而使电容内有了电荷，在这个电容的另一端，接有一个单向导通的电子泵，将电容内的电荷送到另一个电容内储存，当所积累的电荷达到2V时，此电容可做为电源为其它电路提供工作电压，将卡内数据发射出去或接取读写器的数据。
读取数据流程

1、检测是否有人打卡（寻卡），2、防冲突，3、选择这张卡（目的是确认写入卡片），4、进入三次相互验证（对于门禁系统来说仅涉及1，2步骤）

卡的类型

 	Mifare UltraLight又称为MF0，遵循ISO14443A协议，是一个低成本、小容量的卡片，其存储容量只有512bit(Mifare S50有8192bit)。

​	Page0和Page1以及Page2的第1个字节是卡片的7字节序列号及其校验字节，其中BCC0=0x88⊕SN0⊕SN1⊕SN2，BCC1=SN3⊕SN4⊕SN5⊕SN6，SN0是制造商代码，由于Mifare UltraLight是NXP公司出品，因而SN0固定为04H。Page2的第2个字节Internal作为内部数据保留。以上共10个字节出厂时固化在存储区内，用户无法更改。

​	Page3是一次性烧录(One Time Programmable,OTP)页,该页的内容在卡片出厂时全部被写为“0”，用户使用时只能把某一位的内容写为“1”，而永远也不能把“1”写为0，也就是说，新写入的4字节内容与卡内原来的内容进行异或，异或后的结果存储在卡片中。

​	Page4-Page15是可读写的用户数据区，出厂时其内容初始化为0，用户可以任意读写。

​	  Page2的第3和第4个字节用于将存储区锁定为只读。



​	Mifare UltraLight的读写操作和 Mifare S50是完全兼容的，这里的“兼容”是指二者可以使用同一个读卡器硬件，同一套软件。当然若软硬件完全相同就不是两种卡了，二者的区别主要体现在软件操作上，包括以下4个方面：

  一是Mifare UltraLight的卡序列号有7个字节，而Mifare S50的卡序列号只有4个字节，因此在卡片防冲突选择阶段需要两层(Cascade，93H和95H)操作；
  二是Mifare UltraLight没有密码，不需要验证；
  三是Mifare UltraLight的Page相当于Mifare S50的BLOCK，因此Mifare UltraLight有16个BLOCK，且每个BLOCK只有4个字节，而Mifare S50有64个BLOCK,每个BLOCK有16个字节；
  四是Mifare UltraLight没有电子钱包功能。
  基于以上四点，在Mifare S50的程序中在卡请求命令成功执行后，如果判断卡类型字节为Mifare UltraLight(0044H),则在之后的操作中增加第二层防冲突选择，卡选择成功后直接对卡片的0-15块进行读写操作，每次读写只关注前4个字节，不使用电子钱包功能，这样就可以两种卡片完全兼容了。
  Mifare UltraLight适合一次性、不需要回收的低成本的电子票证、景区门票等场合的解决方案，据说推出Mifare UltraLight的本来目的是想与125KHz的ID卡竞争，并作为磁条卡的替代方案。从目前的情况看，Mifare UltraLight与ID卡的竞争情况并不乐观，而磁条卡的替代品也大多是ID卡。